# WhiskrIO 使用方法

## 目次

1. [初回セットアップ](#初回セットアップ)
2. [基本的な使い方](#基本的な使い方)
3. [高度な機能](#高度な機能)
4. [トラブルシューティング](#トラブルシューティング)

## 初回セットアップ

### 1. アプリの起動

```bash
# ビルド後にアプリを起動
open WhiskrIO/WhiskrIO.app
```

初回起動時は、システム設定で以下の権限を許可する必要があります：

1. **マイク** - 音声入力に使用
2. **アクセシビリティ** - 他アプリへのテキスト入力に使用

### 2. APIキーの設定

1. メニューバーから 🎙️ をクリック
2. 「設定...」を選択
3. 「API」タブをクリック
4. Google AI Studio で取得した Gemini API キーを入力
5. 「検証」ボタンでキーを確認

**APIキー取得方法**:
1. [Google AI Studio](https://aistudio.google.com/app/apikey) にアクセス
2. 「Create API Key」をクリック
3. 生成されたキーをコピー
4. WhiskrIO設定画面で 📋 ボタンをクリックしてペースト

**注意**: APIキーは Keychain に安全に保存されます。

## 基本的な使い方

### 音声入力

#### Push to Talk モード（デフォルト）

1. **キーを押す**: ⌥ Option + ⌘ Command を押し続ける
2. **自然に話す**: キーを押している間、音声を録音します
3. **キーを離す**: 録音が自動的に停止し、文字起こしが開始されます
4. **自動入力**: 変換されたテキストがアクティブなアプリに入力されます

#### トグルモード

1. **録音開始**: `⌘⇧F3`（またはメニューから「録音開始」）
2. **自然に話す**: 句読点を気にせず話してください
3. **録音停止**: もう一度 `⌘⇧F3`
4. **自動入力**: 変換されたテキストがアクティブなアプリに入力されます

### モードの切り替え

1. メニューバーから設定を開く
2. 「ホットキー」タブを選択
3. 「モード」を「Push to Talk」または「トグルモード」に切り替え
4. Push to Talkの場合は使用する修飾キーを選択

## 高度な機能

### カスタムプロンプト

文字起こしの挙動をカスタマイズできます。

1. 設定 → 「プロンプト」タブ
2. 「文字起こしプロンプト」セクションで編集
3. 自分好みのプロンプトを入力

**デフォルトプロンプト**:
```
Transcribe the following audio to text.
Remove filler words like "um", "uh", "like", "you know".
Add appropriate punctuation.
Format as clean, readable text.
```

**カスタム例**:
```
以下の音声を文字起こししてください。
「えーと」「あの」などのフィラーワードは削除。
適切な句読点を追加。
敬語で整えてください。
```

### コマンドモード

音声でzshコマンドを生成できます。

1. 音声入力の先頭に「コマンド」と言う
2. 実行したい内容を自然に話す
3. zshコマンドが生成されて入力される

**例**:

| 音声入力 | 出力 |
|----------|------|
| 「コマンド ホームディレクトリのファイル一覧」 | `ls ~` |
| 「コマンド 現在のディレクトリのGit状態確認」 | `git status` |
| 「command find all PDF files in downloads」 | `find ~/Downloads -name "*.pdf"` |

**トリガーワードのカスタマイズ**:
1. 設定 → 「プロンプト」タブ
2. 「コマンドモード」セクションで編集
3. ×ボタンで削除、テキストフィールドで追加

### ルールシステム（.cursorrules風）

YAMLファイルで柔軟なルールを定義できます。

#### 設定ファイルの作成

```bash
mkdir -p ~/.config/gemisper
cp rules.yaml.sample ~/.config/gemisper/rules.yaml
open ~/.config/gemisper/rules.yaml
```

#### ルール定義例

```yaml
version: "1.0"

triggers:
  # zshコマンド生成
  - name: "zshコマンド"
    keywords: ["コマンド", "command", "cmd", "zsh"]
    action: "generate_command"
    parameters:
      shell: "zsh"
      explain: "false"
  
  # 英語翻訳
  - name: "英語翻訳"
    keywords: ["英語", "english", "en"]
    action: "translate"
    parameters:
      target_lang: "en"
  
  # Markdown整形
  - name: "Markdown整形"
    keywords: ["markdown", "md"]
    action: "format"
    parameters:
      format: "markdown"

defaults:
  prompt: |
    Transcribe the audio to text.
    Remove filler words.
    Add punctuation.

templates:
  command: |
    {command}
  
  translate: |
    【{target_lang}訳】
    {translated}
```

#### 対応アクション

| アクション | 説明 | パラメータ |
|------------|------|-----------|
| `generate_command` | zsh/bashコマンド生成 | `shell`, `explain` |
| `translate` | 翻訳 | `target_lang`, `source_lang` |
| `format` | フォーマット整形 | `format` (markdown/json) |
| `generate_code` | コード生成 | `language`, `add_comments` |
| `custom` | カスタムプロンプト | `prompt` |

### カスタム辞書

頻繁に使う単語やフレーズの変換ルールを登録できます。

**設定方法**:
1. メニュー → 「カスタム辞書...」
2. 「変換前」と「変換後」を入力
3. 「追加」ボタンをクリック

**使用例**:

| 変換前 | 変換後 |
|--------|--------|
| カイシャ | 株式会社WhiskrIO |
| デンワ | 電話: 03-1234-5678 |
| マエガキ | （前置きを削除して空欄）|

### スニペット

特定のキーワードで長いテキストを展開できます。

**設定方法**:
1. メニュー → 「スニペット...」
2. 「トリガー」と「展開後」を入力
3. 「追加」ボタンをクリック

**使用例**:

| トリガー | 展開後 |
|----------|--------|
| @mail | your.email@example.com |
| @signature | --\n山田太郎\n株式会社WhiskrIO |
| @date | （現在日付）|

### 使用量の確認

メニューバーから直近の使用量を確認できます。

メニュー表示例:
```
🎙️ WhiskrIO v1.0.0
━━━━━━━━━━━━━━
Push to Talk (⌥ + ⌘)
━━━━━━━━━━━━━━
設定...
カスタム辞書...
スニペット...
━━━━━━━━━━━━━━
使用量
  直近: 1,234 tokens
  概算: $0.0012 (¥0.18)
  今日の累計: 5,678 tokens
  今日の概算: $0.0056 (¥0.84)
  今月の累計: 45,210 tokens
  今月の概算: $0.0452 (¥6.78)
━━━━━━━━━━━━━━
終了
```

## トラブルシューティング

### 「Gemini APIキーが必要です」と表示される

1. システム設定 → プライバシーとセキュリティ → キーチェーンアクセスを確認
2. 設定画面でAPIキーを入力し、「検証」ボタンをクリック
3. Google AI Studioでキーが有効か確認

### 音声が認識されない

- マイク権限が許可されているか確認
- インターネット接続を確認
- Gemini API の利用制限に達していないか確認

### テキストが入力されない

- アクセシビリティ権限を確認
- 対象アプリがテキスト入力を受け付ける状態か確認

### コマンドモードが動作しない

- 設定 → プロンプト → コマンドモードのトリガーワードを確認
- 音声入力の先頭にトリガーワードが含まれているか確認
- ルールファイル（`~/.config/gemisper/rules.yaml`）の構文を確認

## ヒント

### 効率的な使い方

1. **句読点を意識しない**: AIが自動で追加します
2. **自然に話す**: ゆっくり明瞭に話すと認識精度が上がります
3. **固有名詞は辞書登録**: 人名や会社名を辞書に登録すると正確に変換されます
4. **スニペット活用**: 定型文はスニペット化して短縮入力

### 音声入力のコツ

- 小さい声でも認識します（ウィスパーモード）
- 短い文章を複数回に分けて入力するのが効率的
- 修正が必要な場合は、該当部分のみを再録音

### キーボードショートカット

| ショートカット | 動作 |
|---------------|------|
| `⌥Option + ⌘Command` | 録音開始/停止（Push to Talk） |
| `⌘⇧F3` | 録音開始/停止（トグルモード） |
| `⌘,` | 設定を開く |

※ ホットキーは設定で変更可能
